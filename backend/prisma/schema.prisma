generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Experiment {
  id             String   @id @default(cuid())
  name           String
  description    String?
  type           String   @default("AB")
  status         String   @default("DRAFT")
  strategy       String   @default("FIXED")
  startTime      DateTime?
  endTime        DateTime?
  notes          String?
  decision       String?
  decisionReason String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  arms    Arm[]
  metrics Metric[]
}

model Arm {
  id            String    @id @default(cuid())
  experimentId  String
  name          String
  aiModelId     String?
  initialSplit  Int?
  minSplit      Int?
  maxSplit      Int?
  isChampion    Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  experiment    Experiment @relation(fields: [experimentId], references: [id], onDelete: Cascade)
  metrics       Metric[]
}

model Metric {
  id            String    @id @default(cuid())
  experimentId  String
  armId         String?
  key           String
  value         Float
  createdAt     DateTime  @default(now())

  experiment    Experiment @relation(fields: [experimentId], references: [id], onDelete: Cascade)
  arm           Arm?       @relation(fields: [armId], references: [id], onDelete: Cascade)
}
